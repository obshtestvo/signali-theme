{% load thumbnail %}
{% if user.is_authenticated %}
<login-box action="#settings">
    {% thumbnail user.get_avatar "30x30" crop="center" as img %}
        <img src="{{ img.url }}" width="{{ img.width }}" height="{{ img.height }}"
             alt="Твоята снимка"/>
    {% endthumbnail %}
    <strong>{{ user.get_full_name }}</strong>
    <ul>
        <li><a href="#settings" target="modal" settings-trigger>Настройки</a></li>
        <li><a href="{% url 'security:logout' %}">Изход</a></li>
    </ul>
</login-box>
<div modal-hider>
    <modal id="settings">
        <headline size="large" density="airy" align="center">Настройки</headline>
        <settings action="{% url 'user:profile' pk=user.id %}">
            <tabs align="center">
                <li><a class="active" href="#generalSettings">Общо</a></li>
                <li><a href="#passwordSettings">Смяна на парола</a></li>
            </tabs>
            <section id="generalSettings" tab>
                <text-field size="full" id="name" type="text" name="name" value="{{ user.get_full_name }}" >
                    Име
                </text-field>
                <text-field size="full" id="email" type="email" value="{{ user.email }}" placeholder="твоята@епоща.бг">
                    имейл адрес
                </text-field>
            </section>
            <section id="passwordSettings" tab hidden>
                <text-field size="full" id="password" type="password" name="name" >
                    Текуща парола
                </text-field>
                <text-field size="full" id="new_password1" type="password" >
                    Нова парола
                </text-field>
                <text-field size="full" id="new_password2" type="password" >
                    Нова парола (пак)
                </text-field>
            </section>
            <action-button button align="left" type="primary" fill="solid" color="red">
                запази
            </action-button>
        </settings>
    </modal>
</div>
{% else %}
<login-box anonymous action="#generic-auth">
    Вход
</login-box>
<div modal-hider>
    <modal id="generic-auth" auth-modal="main" auth-container>
        <headline size="large" density="airy" align="center" for="modal"></headline>
        <auth-modal-patch for="registration">
            <auth-title>Регистрация</auth-title>
        </auth-modal-patch>
        <auth-modal-patch for="login">
            <auth-title>Вход</auth-title>
        </auth-modal-patch>
        <auth type="login" action="{% url 'security:complete' 'email' %}" auth-replace="login-box">
            <site-auth registration-action="" login-action="" type="login" size="compact" class="half">
                <input type="hidden" name="auth_type" value="login"/>
                <notification error size="medium" density="comfortable" for="form" hidden>Прегледайте грешките по-долу</notification>
                <text-field for="registration" validate-group="registration" size="full" id="name" name="name" type="text" required>
                    Име
                    <notification error size="text-field" hidden></notification>
                </text-field>
                <text-field size="full" id="email" validate-group='["registration", "login"]' name="email" type="email" state="information" required>
                    имейл адрес
                    <notification error size="text-field" hidden></notification>
                    <notification information size="text-field">
                        <p>
                            Няма да пращаме нежелани съоб&shy;ще&shy;ния
                        </p>
                    </notification>
                </text-field>
                <text-field size="full" id="new_password1" name="new_password1" validate-name="password" validate-group='["registration", "login"]' type="password" required minlength="6">
                    Парола
                    <notification error size="text-field" hidden></notification>
                </text-field>
                <text-field for="registration" id="new_password2"  name="new_password2" validate-group="registration" size="full" type="password" required validate-equalto-form-sibling="#new_password1">
                    Парола (пак)
                    <notification error size="text-field" hidden></notification>
                </text-field>
                <action-button submit for="login" type="primary" fill="solid" align="left" color="red">
                    вход
                </action-button>
                <action-button submit for="registration" type="primary" fill="solid" align="left" color="red">
                    регистрация
                </action-button>
                <action-button helper align="right" for="login" action="google.com" density="comfortable">
                    Забравена парола?
                </action-button>
                <action-button helper auth-trigger align="right" for="registration" type="login" density="comfortable">
                    <span>или</span> вход
                </action-button>
            </site-auth>
            <social-auth type="login" size="compact" class="half">
                <headline size="small" density="comfortable">Или чрез Facebook</headline>
                <notification information size="small" no-icon>
                    <p>Няма да пускаме съобщения от ваше име.</p>
                </notification>
                <social-button facebook action="{% url 'security:begin' 'facebook' %}"></social-button>
                <social-button google action="{% url 'security:begin' 'google' %}"></social-button>
            </social-auth>
        </auth>
        <footer for="login">
            <a auth-trigger type="registration">Направи си регистрация</a>
        </footer>
    </modal>
    {# Modal message for alert, success, error #}
    <modal>
        <headline size="large" density="airy" align="center">Регистрация</headline>
        <notification success size="popup">
            <strong>Успешна регистрация</strong>
            <p>Easy one click sign in. We won't post anything without your permission.</p>
        </notification>
    </modal>
</div>
{% endif %}